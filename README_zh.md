# CarrotAI

<div align="center">
  <img src="public/icon.png" alt="CarrotAI Logo" width="200"/>
  <h3>å¤šè¯­è¨€,æ”¯æŒMCPçš„ AI Agent</h3>
  <p>Flutter + FastAPI</p>
</div>

<p align="center">
  ğŸš€ <a href="https://chat.jintongshu.com/">åœ¨çº¿ä½“éªŒ</a>  |  <a href="https://jintongshu.com/download/">SaaS å®¢æˆ·ç«¯ä¸‹è½½</a>
</p>

---

## ğŸ¥• ä»‹ç»

CarrotAI æ˜¯ä¸€ä¸ªå‰æ²¿çš„ AI Agentåº”ç”¨ï¼Œé€šè¿‡æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆSSEï¼‰å’Œå†…ç½®æ¨¡å‹æ§åˆ¶åè®®ï¼ˆMCPï¼‰é›†æˆï¼Œå®ç°å®æ—¶æµå¼èŠå¤©ã€‚å®ƒæ”¯æŒåŒæ—¶è¿æ¥å¤šä¸ª SSE MCP æœåŠ¡å™¨ï¼Œå¹¶æä¾›è‹±æ–‡ã€ä¸­æ–‡å’Œæ—¥æ–‡çš„ç”¨æˆ·ç•Œé¢ã€‚

## ğŸš€ åŠŸèƒ½

- **AI ä»£ç†**ï¼šåŸºäº SSE å’Œ MCP é€‚é…å™¨çš„å®æ—¶èŠå¤©ï¼Œå¸¦æ¥æ— ç¼çš„å¯¹è¯ä½“éªŒã€‚
- **å¤šæœåŠ¡å™¨æ”¯æŒ**ï¼šåŒæ—¶è¿æ¥å’Œè°ƒç”¨å¤šä¸ª SSE MCP æœåŠ¡å™¨ï¼Œä»¥æ±‡èšæ™ºèƒ½å“åº”ã€‚
- **å¤šè¯­è¨€**ï¼šæä¾›å®Œæ•´çš„è‹±æ–‡ã€ä¸­æ–‡å’Œæ—¥æ–‡æœ¬åœ°åŒ–ã€‚
- **æ·±åº¦æ€è€ƒæ¨¡å¼**ï¼šé’ˆå¯¹å¤æ‚æˆ–å¤šæ­¥éª¤æŸ¥è¯¢çš„é«˜çº§åˆ†æã€‚
- **è®¤è¯**ï¼šä½¿ç”¨ JWT ä»¤ç‰Œçš„å®‰å…¨ç™»å½•/æ³¨å†Œæµç¨‹ã€‚
- **å“åº”å¼ UI**ï¼šé€‚é…ç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯å’Œ Web å¹³å°çš„è‡ªé€‚åº”è®¾è®¡ã€‚
- **ä¸»é¢˜å®šåˆ¶**ï¼šæ”¯æŒäº®/æš—æ¨¡å¼ã€è‡ªå®šä¹‰ä¸»è‰²è°ƒï¼Œä»¥åŠé€šè¿‡ `dynamic_color` å®ç°çš„åŠ¨æ€ Material 3 ä¸»é¢˜ã€‚
- **æ–‡ä»¶ä¸Šä¼ **ï¼šåœ¨å¯¹è¯ä¸­é™„åŠ å’Œè§£ææ–‡ä»¶ï¼Œæä¾›æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ã€‚

## ğŸ¤– æ”¯æŒçš„æ¨¡å‹ API

- **DeepSeek**ï¼šå…·å¤‡å¼ºå¤§æ¨ç†èƒ½åŠ›çš„é«˜çº§è¯­è¨€æ¨¡å‹

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**ï¼šFlutter
- **çŠ¶æ€ç®¡ç†**ï¼šProvider
- **UI**ï¼šMaterial Design 3
- **æœ¬åœ°åŒ–**ï¼šflutter gen-l10n
- **ä¸»é¢˜**ï¼šdynamic_color

### åç«¯
- **æ¡†æ¶**ï¼šFastAPI
- **æµå¼**ï¼šæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆSSEï¼‰
- **AI é›†æˆ**ï¼šDeepSeek LLMï¼ŒMCPï¼ˆæ¨¡å‹æ§åˆ¶åè®®ï¼‰
- **æ•°æ®åº“**ï¼šPostgreSQL + SQLAlchemy
- **èº«ä»½éªŒè¯**ï¼šJSON Web Tokens
- **è¿ç§»**ï¼šAlembic
- **éƒ¨ç½²**ï¼šUvicorn & Gunicorn

## ğŸ“‹ å‰ç½®æ¡ä»¶

- Flutter SDK ^3.7.2
- Python >=3.12
- PostgreSQL

## âš¡ å¿«é€Ÿå¼€å§‹

> è¯·ç¡®ä¿å·²å®‰è£… [uv](https://docs.astral.sh/uv/getting-started/installation/)ã€‚

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/Xingsandesu/CarrotAI.git && cd CarrotAI

# å¤„ç†ç¯å¢ƒå˜é‡
mv backend/.env.example backend/.env && mv .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
vim .env
vim backend/.env

# ä¸´æ—¶å¯åŠ¨ PostgreSQL
docker-compose -f docker-compose.yml -f docker-compose.override.yml up -d postgres

# åç«¯åˆå§‹åŒ–
uv run backend/scripts/startup.py --user --email <email> --username <name> --password <password>

# åœæ­¢ PostgreSQL
docker-compose -f docker-compose.yml -f docker-compose.override.yml down

# é…ç½®æ–‡ä»¶ç¼–è¾‘
vim config/

# å¯åŠ¨åç«¯
docker compose up -d
```

## ğŸ”§ å®‰è£…

### åç«¯é…ç½®

1. è¿›å…¥åç«¯ç›®å½•ï¼š
   ```bash
   cd backend
   ```
2. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š
   ```bash
   uv sync
   ```
3. å¤åˆ¶ç¤ºä¾‹ç¯å¢ƒæ–‡ä»¶ï¼š
   ```bash
   cp .env.example .env
   ```
4. æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼š
   ```bash
   uv run scripts/init_db.py && uv run scripts/init_config.py
   ```
5. å¯åŠ¨æœåŠ¡å™¨ï¼š
   ```bash
   python main.py       # å¼€å‘æ¨¡å¼
   python main.py prod  # ç”Ÿäº§æ¨¡å¼ (Gunicorn)
   ```

### å‰ç«¯é…ç½®

1. è¿”å›é¡¹ç›®æ ¹ç›®å½•ï¼š
   ```bash
   cd ..
   ```
2. è·å– Flutter ä¾èµ–ï¼š
   ```bash
   flutter pub get
   ```
3. ç”Ÿæˆæœ¬åœ°åŒ–æ–‡ä»¶ï¼š
   ```bash
   flutter gen-l10n
   ```
4. è¿è¡Œåº”ç”¨ï¼š
   ```bash
   flutter run
   ```
5. æ„å»º Web ç‰ˆï¼š
   ```bash
   flutter build web --wasm
   ```

## ğŸŒ é…ç½®

- **å‰ç«¯**ï¼šç¼–è¾‘ `lib/core/config/app_config.dart`ï¼Œè®¾ç½® API ç«¯ç‚¹å’Œä¸»é¢˜é»˜è®¤å€¼ã€‚
- **åç«¯**ï¼šåœ¨ `.env` å’Œ `backend/app/core/config.py` ä¸­é…ç½®æ•°æ®åº“å’Œ MCP æœåŠ¡å™¨ã€‚

### åç«¯é…ç½®æ–‡ä»¶

åç«¯ä½¿ç”¨ä½äº `backend/config/` çš„ JSON æ–‡ä»¶æ¥å®šä¹‰æ¨¡å‹ã€MCP æœåŠ¡å™¨å’Œè‡ªå®šä¹‰é€‚é…å™¨ã€‚é»˜è®¤æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š

```text
backend/config/
â”œâ”€â”€ model_configs.json       # LLM æ¨¡å‹å®šä¹‰å’Œå…ƒæ•°æ®
â”œâ”€â”€ mcp_servers.json         # SSE MCP æœåŠ¡å™¨ç«¯ç‚¹å’Œç¯å¢ƒé…ç½®
â””â”€â”€ app/                     # è‡ªå®šä¹‰é€‚é…å™¨å®šä¹‰
    â””â”€â”€ duckduckgo-search.json
```

#### model_configs.json

å®šä¹‰å¯ç”¨çš„ LLM æ¨¡å‹ã€‚æ¯ä¸ªæ¡ç›®åŒ…æ‹¬ï¼š
- `id`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šæ¨¡å‹æ ‡è¯†ç¬¦ã€‚
- `icon`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šæ˜¾ç¤ºå›¾æ ‡åç§°ã€‚
- `translations`ï¼ˆå¯¹è±¡ï¼‰ï¼šæœ¬åœ°åŒ–åç§°å’Œæè¿° (`zh`, `en`, `ja`)ã€‚
- `exclusiveRules`ï¼ˆå¯¹è±¡ï¼‰ï¼šåŠŸèƒ½å¼€å…³å’Œæ’é™¤è§„åˆ™ã€‚

ç¤ºä¾‹ï¼š
```json
[
  {
    "id": "deepseek",
    "icon": "smart_toy_outlined",
    "translations": {
      "zh": { "name": "DeepSeek", "description": "ä¸“æ³¨äºæ·±åº¦æ€è€ƒå’Œå¤æ‚æ¨ç†çš„æ»¡è¡€æ¨¡å‹" },
      "en": { "name": "DeepSeek", "description": "Powerful Chinese large model focused on deep thinking and complex reasoning" },
      "ja": { "name": "DeepSeek", "description": "æ·±ã„æ€è€ƒã¨è¤‡é›‘ãªæ¨è«–ã«ç‰¹åŒ–ã—ãŸå¼·åŠ›ãªä¸­å›½è¯­å¤§è§„æ¨¡ãƒ¢ãƒ‡ãƒ«" }
    },
    "exclusiveRules": {
      "deepThinking": { "enabled": true, "excludes": ["mcpServices"] },
      "mcpServices": { "enabled": true, "excludes": ["deepThinking"] }
    }
  }
]
```

#### mcp_servers.json

æŒ‡å®š SSE æ¨¡å‹æ§åˆ¶åè®® (MCP) ç«¯ç‚¹ã€‚æ ¼å¼ï¼š
- é”®ï¼šæœåŠ¡åç§°ã€‚
- `url`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šSSE ç«¯ç‚¹ URLã€‚
- `env`ï¼ˆå¯¹è±¡ï¼‰ï¼šé€‚é…å™¨ç¯å¢ƒå˜é‡ã€‚

ç¤ºä¾‹ï¼š
```json
{
  "serviceA": {
    "url": "http://localhost:10000/sse",
    "env": {
      "API_KEY": "your_api_key"
    }
  }
}
```

#### è‡ªå®šä¹‰é€‚é…å™¨ (`app/*.json`)

å°†è‡ªå®šä¹‰ MCP é€‚é…å™¨æ”¾åœ¨ `backend/config/app/` ç›®å½•ã€‚æ¯ä¸ªæ–‡ä»¶å®šä¹‰ï¼š
- `id`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šé€‚é…å™¨æ ‡è¯†ç¬¦ã€‚
- `icon`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå›¾æ ‡æˆ– emojiã€‚
- `mcpServer`ï¼ˆå¯¹è±¡ï¼‰ï¼šä¸ `mcp_servers.json` ä¸­æ¡ç›®ç›¸åŒçš„ç»“æ„ã€‚
- `translations`ï¼ˆå¯¹è±¡ï¼‰ï¼šæœ¬åœ°åŒ– UI å…ƒæ•°æ®ã€‚

ç¤ºä¾‹ (`duckduckgo-search.json`)ï¼š
```json
{
  "id": "duckduckgo-search",
  "icon": "ğŸ”",
  "mcpServer": {
    "url": "http://localhost:10000/duckduckgo-search",
    "env": {}
  },
  "translations": {
    "en": { "name": "DuckDuckGo Search", "type": "Search Tool", "description": "Use DuckDuckGo search engine for secure and private web searches" },
    "zh": { "name": "DuckDuckGoæœç´¢", "type": "æœç´¢å·¥å…·", "description": "ä½¿ç”¨ DuckDuckGo æœç´¢å¼•æ“è¿›è¡Œå®‰å…¨ã€ç§å¯†çš„ç½‘ç»œæœç´¢" },
    "ja": { "name": "DuckDuckGoæ¤œç´¢", "type": "æ¤œç´¢ãƒ„ãƒ¼ãƒ«", "description": "DuckDuckGoæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ç”¨ã—ã¦å®‰å…¨ã§ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªã‚¦ã‚§ãƒ–æ¤œç´¢ã‚’è¡Œã„ã¾ã™" }
  }
}
```

#### ä½¿ç”¨æ–¹æ³•

1. åˆå§‹åŒ–é»˜è®¤é…ç½®ï¼š
   ```bash
   uv run scripts/init_config.py
   ```
2. åœ¨ `backend/config/` ç›®å½•ä¸‹ä¿®æ”¹ JSON æ–‡ä»¶ï¼Œä»¥æ·»åŠ æˆ–æ›´æ–°æ¨¡å‹å’Œç«¯ç‚¹ã€‚
3. é‡å¯åç«¯æœåŠ¡å™¨ä»¥åº”ç”¨æ›´æ”¹ã€‚

## ğŸ”§ ç¯å¢ƒå˜é‡

**åç«¯ (.env)**

| é”®                      | æè¿°                                 | é»˜è®¤     |
|-------------------------|--------------------------------------|----------|
| DATABASE_URL            | PostgreSQL è¿æ¥ URL                  | *å¿…éœ€*   |
| BACKEND_CORS_ORIGINS    | å…è®¸çš„ CORS æ¥æº (é€—å·åˆ†éš”)           | []       |
| MCP_SERVERS             | SSE MCP æœåŠ¡å™¨ç«¯ç‚¹åˆ—è¡¨ (JSON æ ¼å¼)   | *å¿…éœ€*   |
| SECRET_KEY              | JWT å¯†é’¥                             | *å¿…éœ€*   |

**å‰ç«¯ (lib/core/config/app_config.dart)**
```dart
static String get baseUrl => "http://127.0.0.1:8000";
```

## ğŸ’¡ ä½¿ç”¨æ–¹æ³•

1. æŒ‰"å¿«é€Ÿå¼€å§‹"ä¸­æ‰€ç¤ºå¯åŠ¨åç«¯å’Œå‰ç«¯ã€‚
2. åœ¨æµè§ˆå™¨æˆ–ç§»åŠ¨æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€åº”ç”¨ã€‚
3. æ³¨å†Œæˆ–ç™»å½•ä»¥è·å– JWT ä»¤ç‰Œã€‚
4. ä½¿ç”¨æ·±åº¦æ€è€ƒæ¨¡å¼æˆ–é»˜è®¤èŠå¤©æ¨¡å¼ä¸ AI ä»£ç†äº¤äº’ã€‚
5. åœ¨è®¾ç½®ä¸­åˆ‡æ¢ MCP æœåŠ¡å™¨æˆ–æ·»åŠ æ–°ç«¯ç‚¹ã€‚

## ğŸ”— API å‚è€ƒ

åœ¨ä¸‹é¢è®¿é—®äº¤äº’å¼ Swagger UIï¼š

```
http://127.0.0.1:8000/docs
```

## ğŸ›£ï¸ è·¯çº¿å›¾

- [x] SSE å¤šæœåŠ¡å™¨æ”¯æŒ
- [x] å¤šè¯­è¨€ (EN, ä¸­æ–‡, æ—¥æœ¬èª)
- [x] Docker Compose æ”¯æŒ
- [ ] æœ¬åœ° Stdio å¤šæœåŠ¡å™¨æ”¯æŒ
- [ ] æœ¬åœ° OCR æ”¯æŒ
- [ ] æ”¯æŒæ›´å¤šæ ¼å¼çš„ä¸Šä¼ ç•Œé¢
- [ ] å‰ç«¯è‡ªå®šä¹‰æç¤º
- [ ] æ”¯æŒæ›´å¤šæ¨¡å‹
- [ ] æ”¯æŒæ›´å¤šè¯­è¨€

## ğŸ›¡ï¸ å®‰å…¨

- **è®¤è¯**ï¼šæ‰€æœ‰åç«¯æ¥å£å‡é€šè¿‡ JWT ä¿æŠ¤ï¼›ä»¤ç‰Œå®‰å…¨åŠ å¯†å­˜å‚¨ã€‚
- **æ•°æ®ä¿æŠ¤**ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPSï¼›åœ¨ `.env` ä¸­é€šè¿‡ `BACKEND_CORS_ORIGINS` é…ç½®å…è®¸çš„ CORS æ¥æºã€‚
- **å¯†é’¥ç®¡ç†**ï¼šåœ¨ `.env` ä¸­å®šä¹‰ `SECRET_KEY`ï¼›ç¡®ä¿ä¸å°†å¯†é’¥æäº¤åˆ°æºä»£ç ã€‚

## ğŸ” ç›‘æ§ä¸æ—¥å¿—

- **æœåŠ¡å™¨æ—¥å¿—**ï¼šåœ¨ `gunicorn.conf.py` ä¸­é…ç½®ï¼›è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—ä½äº `logs/`ã€‚
- **åº”ç”¨æ—¥å¿—**ï¼šä½¿ç”¨ Loguru è¿›è¡Œç»“æ„åŒ–æ—¥å¿—ï¼›åœ¨å‘å¸ƒæ¨¡å¼ä¸‹å‰ç«¯ç¦ç”¨ `debugPrint`ã€‚

## ğŸš€ æ€§èƒ½ä¸ä¼˜åŒ–

- **ç¼“å­˜**ï¼šå‰ç«¯ç¼“å­˜é™æ€èµ„æºï¼›åç«¯å¯¹ PostgreSQL ä½¿ç”¨å¼‚æ­¥è¿æ¥æ± ã€‚
- **åŒ…ä½“ç§¯**ï¼šWeb äº§ç‰©é€šè¿‡ `--wasm` æ„å»ºï¼Œå®ç°ä¼˜åŒ–äº¤ä»˜ã€‚

## ğŸ—‚ï¸ æ›´æ–°æ—¥å¿—

> æ‰€æœ‰é‡è¦æ›´æ”¹å‡è®°å½•åœ¨ [CHANGELOG.md](CHANGELOG.md)ã€‚

## ğŸ“± æˆªå›¾

<div align="center">
  <img src="images/home.png" width="280"/>
  <img src="images/shop.png" width="280"/>
  <img src="images/env.png" width="280"/>
</div>

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·æäº¤ Pull Request å¹¶æå‡ºæ‚¨çš„å»ºè®®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª CarrotAI å¼€æºè®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚ 